---
title: "氷山モデルで問題の構造を見抜く方法"
emoji: "🧊"
type: "idea" # tech: 技術記事 / idea: アイデア
topics: ["設計", "システム思考", "問題解決"]
published: false
---

# TL;DR

- 目に見える問題（バグ、障害）は「氷山の一角」。水面下に**パターン・構造・メンタルモデル**が隠れている
- AIに聞けば表面的な修正はできる。しかし**構造を変えないと同じ問題は繰り返される**
- 問題が起きたら「どう直す？」の前に「**これは何層の問題か？**」と問いかける習慣が重要
- 最も効果的な介入は**層3（構造）または層4（メンタルモデル）**への対応

# はじめに

こんにちは、Dress Code でエンジニアをしている[ないとー](https://x.com/_bwkw_)です。
このブログは [Dress Code Advent Calendar 2025](https://adventar.org/calendars/12017) の18日目の記事です！

突然ですが、こんな経験ありませんか？

- テストが落ちた → AIに聞いて修正 → 通った → 翌週また別の箇所で似たエラー
- PRでレビュー指摘 → AIで修正 → マージ → 次のPRでも同じ指摘
- 本番障害発生 → AIでホットフィックス → 復旧 → 翌月また類似障害

本番障害の場合、まず復旧が最優先。表面的な対応で問題ありません。

でも、テストやレビューでも同じ対応を繰り返していませんか？

「直せば動く」「AIが答えをくれる」——これは事実です。しかし、**なぜその問題が起きたのか**を掘り下げないと、同じ種類の問題は繰り返されます。

この記事では、問題の表面ではなく**構造**を捉えるためのフレームワーク「氷山モデル」を紹介します。繰り返される問題に悩んでいる方の参考になれば幸いです👋

# 氷山モデルとは

氷山モデルは、「**システム思考**」という分野で使われるフレームワークです（参考：ドネラ・メドウズ『[世界はシステムで動く](https://www.amazon.co.jp/dp/4862761801)』）。

氷山の一角という言葉がありますが、システムの問題も同じです。見えている現象の背後に、より深い層の構造が隠れています。

<!-- 氷山のイラストを差し込む：水面上に「出来事」、水面下に「パターン」「構造」「メンタルモデル」が見える構成 -->

```
┌─────────────────────────────────┐
│  層1：出来事（Events）           │ ← 何が起きたか
├─────────────────────────────────┤
│  層2：パターン（Patterns）       │ ← 繰り返す傾向
├─────────────────────────────────┤
│  層3：構造（Structures）         │ ← なぜ繰り返すか
├─────────────────────────────────┤
│  層4：メンタルモデル             │ ← 根底の前提・信念
└─────────────────────────────────┘
```

| 層  | 問い                         | 例                       |
| --- | ---------------------------- | ------------------------ |
| 層1 | 何が起きた？                 | テストが落ちた           |
| 層2 | 同じことが繰り返されている？ | 毎週似たエラーが出る     |
| 層3 | なぜ繰り返す？               | テスト設計のルールがない |
| 層4 | 何を当たり前だと思っている？ | 「テストは動けばいい」   |

層1だけ対応しても、問題は繰り返されます。では、具体例で見ていきましょう。

# 具体例：N+1問題が繰り返される

<!-- 氷山のイラストを差し込む：水面上に「一覧画面が遅い」、水面下に層2〜4が見える構成 -->

## 層1：出来事

「一覧画面が遅い」「APIレスポンスが3秒かかる」

AIに聞くと「`includes` を追加してください」と教えてくれる。追加すると直る。解決——と思いきや、翌月また別の画面で同じ報告が上がる。

## 層2：パターン

過去半年のパフォーマンス関連チケットを見返すと、こんな傾向が見えてくる。

- 新機能リリース後、1〜2週間で「遅い」という報告が来る
- 特に一覧表示系の画面で多い
- 修正内容はほぼ毎回「N+1の解消」

**パターンが見えた：新機能をリリースするたびに、N+1問題が後から発覚している。**

## 層3：構造

なぜこのパターンが繰り返されるのか。開発プロセスを見ると、構造的な問題が見えてくる。

1. **確認する仕組みがない**：クエリ発行数をログやAPMで確認する習慣がない
2. **開発環境と本番の乖離**：開発環境のデータは10件、本番は10万件。開発時は気づけない
3. **レビュー観点の欠如**：コードレビューで「このクエリ、ループ内で呼ばれてない？」という観点がない

## 層4：メンタルモデル

これらの構造が放置されているのは、チームに無意識の前提があるからかもしれない。

「メンタルモデル」とは、チームや個人が無意識に持っている前提や信念のことです。この概念は、ピーター・センゲの『[学習する組織](https://www.amazon.co.jp/dp/4862761011)』で詳しく解説されています。

- 「**ORMが最適化してくれる**」→ 実際はSQLを隠すだけで、最適化はしない
- 「**開発環境で動けば本番でも動く**」→ データ量が違えば挙動も違う
- 「**パフォーマンスは後から直せばいい**」→ 後から直すコストの方が高い

## 層ごとの対応の違い

| 層  | 対応                                                               | 結果                                     |
| --- | ------------------------------------------------------------------ | ---------------------------------------- |
| 層1 | `includes` を追加する                                              | 直る。でも来月また別の画面で同じ問題     |
| 層3 | クエリログを常時出力 + 本番相当のデータで確認 + レビュー観点に追加 | N+1問題の発生頻度が大幅に減る            |
| 層4 | 「ORMはSQLを隠すが、最適化はしない」という共通認識をチームで持つ   | 開発者が自然とクエリを意識するようになる |

# 実践：3ステップで氷山を掘り下げる

## ステップ1：繰り返される問題を選ぶ

「また同じようなバグが...」と思ったことがある問題を1つ選ぶ。

## ステップ2：4層で整理する

「なぜ？」を繰り返して層を掘り下げるのは、トヨタ生産方式の「**5 Whys**」に近い考え方です。

| 層  | 問い                                             |
| --- | ------------------------------------------------ |
| 層1 | 具体的に何が起きた？                             |
| 層2 | 同じことが繰り返されてる？いつ、どこで？         |
| 層3 | なぜ繰り返す？仕組み・ルール・プロセスに問題は？ |
| 層4 | チームが「当たり前」と思っていることは？         |

## ステップ3：層3か層4に介入する

層1だけ直しても繰り返される。層3（構造）を変えると、層1の問題も自然に減る。

層4（メンタルモデル）を変えるのは難しいが、層3を変えることで、結果的に層4も変わることがある。

# おわりに

この記事では、問題の表面ではなく構造を捉えるための「氷山モデル」を紹介しました。

- 目に見える問題は氷山の一角。水面下に**パターン・構造・メンタルモデル**がある
- AIに聞けば層1は直せる。でも**構造を変えないと同じ問題は繰り返される**
- 問題が起きたら「どう直す？」の前に「**これは何層の問題か？**」と問いかける

次にバグ報告やテスト失敗に遭遇したとき、反射的に修正する前に、少しだけ立ち止まってみてください。

「これ、先月も似たようなの見たな」と思ったら、それは氷山を掘り下げるチャンスです。

この記事が、繰り返される問題に悩んでいる方の参考になれば幸いです👋
