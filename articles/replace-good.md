---
title: "リプレイス1年の現場で見えた、やって良かった7つのこと"
emoji: "🚚"
type: "idea" # tech: 技術記事 / idea: アイデア
topics: ["リプレイス"]
published: false
publication_name: "levtech"
---

# TL;DR

- 具体的な数値や実例を用いた事前準備で、**“説得力”** のある合意形成を実現
- リプレイス専任チーム体制の構築で、**“推進力”** を確保
- 不要コードの早期削除によって、**“運用負荷”** を最小化
- プロセス標準化により、**“迷い”** をなくし効率的な推進を実現
- 段階的リリースで **“影響を局所化”** し、リスクを最小限に抑えながら着実に進行
- リプレイス完了基準を明確にし、**“成果の見える化”** を実現
- 改善タスクを定期的に実施し、**“技術負債”** を着実に解消

# はじめに

こんにちは、リプレイスチームでバックエンドをメインに担当している内藤です！

私は、これまで1年ほど Web アプリケーションのリプレイスプロジェクトに携わってきましたが、その過程で「やって良かった」と実感できる取り組みを多く得ることができました。

リプレイスに関する技術的な情報は世の中に多くありますが、プロセスにフォーカスした話は意外と少ないと感じています。実際、我々も最初は「どう進めれば上手くいくんだろうか？」と悩むことが多かったです。

そこで本記事では、現場での経験をもとに、特に効果的だった7つのポイントを厳選してご紹介します。「これからリプレイスに取り組む方」や「現場でのヒントを探している方」が、少しでも迷いなく前進できる材料になれば幸いです👋

# 前提
// サービスの説明は書かない
// CakePHP, jQuery → NestJs, Next.js
// EC2 → ECS

# その1. 事前準備で “説得力” を持たせる

リプレイスプロジェクトを始める際、最初に越えるべき壁は「**なぜ今リプレイスが必要か？**」を社内で納得してもらうことです。ここで重要なのは、抽象的な説明ではなく、具体的な数値や実例を用いて説得力を持たせることです。

まず、我々はリプレイスを行わなかった場合に発生し得るリスクを明確に示しました。たとえば、直近でどれだけのセキュリティリスクが潜んでいるか、そしてそのセキュリティリスクが実際に突かれた場合に事業へどの程度の影響が及ぶかという観点で、現状を整理しました。（※ 我々は金額面での損失試算までは行いませんでしたが、必要に応じてそうした定量的な試算も有効だと考えています。）

:::message
実際のセキュリティリスク説明資料は外部公開できるものではないので、割愛させていただきます🙏
:::

さらに、変更容易性の低いシステムが事業に与える影響についても、既存コードを分析し、どの部分が変更容易性を下げているのかを具体的に整理しました。その上で、「コード品質が低いとバグが15倍多発し、問題解決にかかる時間が2倍以上に増加する」といった[研究結果](https://arxiv.org/abs/2203.04374)などの客観的データを交えて説明することで、納得感を高めました。

![変更容易性の低さが事業に与える影響](/images/replace_good/henkoyoisei.png)

加えて、既存システムの現状を正確に把握するために、コードの複雑さや依存関係を詳細に調査し、その調査結果を基にリプレイスに必要な期間や工数の大まかな見積もりも作成し、関係者に提示しました。

![スケジュール見積もり](/images/replace_good/estimate.png)

これらの情報を総合的に示すことで、「リプレイスを実施しなかった場合のリスク」と「リプレイスに投下するべきリソースや期間」のバランスを関係者が具体的にイメージできるようになり、プロジェクトの必要性や緊急性を納得してもらうことができました。リプレイス推進の土台を固めるうえで、最初にこの「**腹落ち感**」を得ることが、後のプロジェクト進行にも大きく寄与したと感じています。

# その2. 体制づくりで “推進力” を確保する

当初、我々のチームはリプレイスを進めたいと思いながらも、日々の運用保守業務と並行して対応していたため、どうしてもリプレイスの優先度が下がり、後回しになってしまうことが多々ありました。おそらく、同じような状況に悩んでいる方も少なくないのではないでしょうか？

こうした現状を受けて、グループリーダーが開発部全体に現場の声を届けてくれたこと、そしてリプレイスが開発部の年度最優先課題として位置づけられていたことも後押しとなり、開発部全体で他チームとの人員リソース調整が進み、最終的には「**リプレイス専任のチーム**」を立ち上げることができました。専任チームの発足により、リプレイスに必要な意思決定や作業のスピードが格段に向上し、それまで停滞しがちだったプロジェクトも着実に前進するようになりました。

役割を明確に分担し、専任チームがリプレイスの推進力となる体制を築いたことは、プロジェクト成功の大きな要因だったと感じています。もし今、日々の業務とリプレイスを兼任で進めている方がいれば、ぜひ一度「**専任体制**」の導入を検討してみてください。（そんな簡単な話ではないとは思いますが...

# その3. 不要コードの早期削除で “運用負荷” を減らす

リプレイスを進める中で、改めて実感したのが「**不要なコードはできるだけ早く削除すること**」の重要性です。

我々のチームでは、まずアクセスログをもとに過去半年間使われていない機能や API を洗い出し、さらに念のため該当箇所に追加でログを仕込んで、2ヶ月間アクセスがないことを確認しました（我々のサービスは1ヶ月1サイクルで機能が利用されているため、2サイクル未使用なら問題なしと判断）。この手順を経て、不要と判断できたコードについては迷わず削除を進めていきました。また、リプレイスが完了した箇所でも同様の手法で古いコードを速やかに削除し、運用対象となるコードベースの肥大化を防いでいます。

我々は、この取り組みにより、約30本のAPIと1,500行のコードを削除しました（まだ全ては削除しきれていませんが…🥺）。不要なコードを減らしたことで、リプレイスチームにとっては移行対象の機能が把握しやすくなり、運用保守チームにとっても管理すべき範囲が明確になったため、障害対応や調査、メンテナンスの際に余計なコードを気にする必要がなくなるなど、さまざまな効果がありました。

リプレイスのタイミングで不要コードを積極的に削除し、運用対象をスリムに保つことは、プロジェクトの健全な推進と現場の負荷軽減に直結する有効な施策だと実感しています。

# その4. プロセス標準化で “迷い” をなくす

リプレイスを効率的に進めるためには、「**プロセスの標準化**」が不可欠だと痛感しました。特に複数人で作業する場合、各メンバーが独自の進め方をすると、認識のズレや無駄な手戻りが発生しがちです。

私たちが定義した標準プロセスは、外部仕様調査 → 内部仕様調査 → 要件定義 → ドメインモデル図作成 → シーケンス図作成という一連の作業内容の目的や手順、流れをテンプレート化したものです。以下にサンプルで外部仕様調査プロセスの例を示します。
![外部仕様調査プロセスサンプル](/images/replace_good/process_standard.png)

このように各フェーズのおいて、目的、やること、成果物、メンテナンス要否などを明示して管理しています。

この標準化によって得られた主なメリットは以下の4点です：
- **品質の向上**:	一貫した方法論と手順を確立し、プロジェクトごとのばらつきを減少させ、品質を均一に保つ
- **明確な指針の提供**: 開発チームやステークホルダーに対して、各フェーズの具体的な作業内容、成果物を示すことで、混乱や誤解を防ぐ
- **知識の共有と継承**: 過去のプロジェクトの成功・失敗事例を取り入れることで、次のプロジェクトに生かす
- **効率的なプロジェクト管理**: 進捗管理、リソースの割り当て、リスク管理などを効率的に行うための基盤になる

「**プロセスの標準化**」により、チームメンバーが進め方に迷う時間をゼロにし、本来解決すべき課題に集中できる環境を実現できました。この迷いの排除が、リプレイスを加速させる原動力になったと感じています。

# その5. 段階的リリースで “影響を局所化” する

リプレイスを進める上で、私たちは一度に全てを切り替えるのではなく、ページ単位で区切って段階的にリリースする「**[ストラングラーフィグパターン](https://learn.microsoft.com/ja-jp/azure/architecture/patterns/strangler-fig)**」を採用しました。これは、既存システムの一部機能を新しいシステムに少しずつ置き換えていくことで、全体の移行リスクを抑えつつ、現場への影響を最小限にとどめる手法です。

![ストラングラーフィグパターン](/images/replace_good/strangler_fig.png)

私たちのチームでは、新旧リクエストを ALB で振り分けることで、ALB がProxyLayer の役割を担い、ストラングラーフィグパターンを実現し、ユーザ影響が少なく比較的リプレイスしやすい機能（FAQや問い合わせフォームなど）から着手し、問題がなければ次の対象へと範囲を広げていきました。これにより、各リリースごとに影響範囲を明確にコントロールでき、トラブル発生時も迅速な対応が可能になりました。

この「**影響の局所化**」によって、現場の心理的な安心感も自然と生まれ、結果的にプロジェクト全体の推進力にもつながったと感じています。

# その6. リプレイス完了基準を明確にし “曖昧さ” を排除する

リプレイス後の評価は、どうしても「保守性が上がっているはずだ」「セキュリティリスクは減っているだろう」といった定性的な表現に偏りがちですよね。我々のチームもこの定性的な評価にモヤモヤを抱えていました。そこで、完了基準を「**出来る限り定量的**」に設定することを重視しました。

まず内部品質については、[SonarQube for IDE](https://www.sonarsource.com/jp/products/sonarlint/) の「指摘事項がゼロであること」をを最低限の基準にしています。SonarQube for IDE は、IDE 上でリアルタイムにコード品質をチェックできるので、バグやセキュリティリスク、コードスメルをその場で検出・修正でき、日々のコーディング段階から品質を高めるのにとても役立っています。もともとリプレイス前のコードベースでは、SonarQube で「Maintainability（保守性）」のSeverity（深刻度）が Blocker や High（[参考](https://docs.sonarsource.com/sonarqube-server/10.8/instance-administration/analysis-functions/instance-mode/mqr-mode/#mqr-severity)）の指摘が合計で5000件ほどありましたが、現状ではそれを0件まで抑えることができています（もちろん、リプレイス作業はまだ全て完了したわけではありませんが…）。

また、セキュリティ面では、社内の脆弱性管理ツールをCIに組み込み、リリース前のチェックを必須としています。これにより、ヒューマンエラーによる脆弱性の見逃しをゼロにすることができています。

このように、定量的な基準を明確にすることで、「**自信を持ってリプレイスが完了したと言える状態**」を実現できています。曖昧な評価基準のままだと、具体的に何が良くなったのかが分かりづらくなってしまうので、こうした明確な完了基準の設定は重要だと考えています。

# その7. 改善タスクを定期的に実施し “技術負債” を解消する

リプレイスを進めている最中でも、**どうしても技術負債は一定のペースで溜まっていきます。** だからこそ、リプレイスとは別に、その過程で新たに生まれた負債も定期的に解消することが重要だと感じています。

我々のチームでは、ページ単位でリプレイスを進めていますが、各ページのリプレイスが完了するタイミングで、2週間ほど改善タスクに集中する期間を設けています。たとえば直近では、CI の実行時間短縮やフレーキーな CI の改善、テスト間の依存関係の排除によるテストの独立性向上など、日々の開発効率や品質に直結する改善に取り組みました。

実際にリプレイスを進めてみると、どれだけ設計や準備をしても、新しいシステムにもやはり完璧ではない部分が出てきます。「リプレイス作業の合間に時間があればやろう」と有耶無耶にするのではなく、「**リプレイスの節目ごとに改善にしっかり時間を割り当てる**」ことで、新たな負債の蓄積を防ぎ、チーム全体の開発体験も向上しました。結果的に、リプレイス作業自体もよりスムーズに進むようになったと実感しています。

# おわりに

今回は、1年間のリプレイスプロジェクトで **「やって良かったと実感した7つのポイント」** をご紹介しました。

リプレイスは技術的な挑戦だけでなく、チーム体制やプロセス、そして関係者との合意形成など、様々な側面での工夫が求められる複雑なプロジェクトです。我々も最初は手探り状態でしたが、この記事で紹介したような取り組みを通じて、着実に前進させることができたと実感しております。

プロジェクトごとに状況は異なりますが、この記事が少しでも皆さんがリプレイスプロジェクトに取り組む際の参考になれば幸いです👋
